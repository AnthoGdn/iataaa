package com.iataaa.checkersRules.service.impl;

import com.iataaa.checkersRules.model.Case;
import com.iataaa.checkersRules.model.CheckersBoard;
import com.iataaa.checkersRules.model.Player;
import com.iataaa.checkersRules.rules.CheckersCasesTool;
import com.iataaa.checkersRules.rules.CheckersRules;
import com.iataaa.checkersRules.service.CheckersRulesService;
import org.junit.Before;
import org.junit.Test;

import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import static com.iataaa.checkersRules.model.CheckersBoard.PIECE_SIZE;
import static org.assertj.core.api.Java6Assertions.assertThat;

public class CheckersRulesServiceImplTest {

    private CheckersRulesService checkersRulesService;

    @Before
    public void setUp() {
        checkersRulesService = new CheckersRulesServiceServiceImpl();
    }

    @Test
    public void initializeCheckersBoardTest() {
        // GIVEN
        String expectedBoardString =
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "9|       |   o   |       |   o   |       |   o   |       |   o   |       |   o   |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "8|   o   |       |   o   |       |   o   |       |   o   |       |   o   |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "7|       |   o   |       |   o   |       |   o   |       |   o   |       |   o   |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "6|   o   |       |   o   |       |   o   |       |   o   |       |   o   |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "5|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "4|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "3|       |   x   |       |   x   |       |   x   |       |   x   |       |   x   |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "2|   x   |       |   x   |       |   x   |       |   x   |       |   x   |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "1|       |   x   |       |   x   |       |   x   |       |   x   |       |   x   |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "0|   x   |       |   x   |       |   x   |       |   x   |       |   x   |       |\n" +
            " |---0---|---1---|---2---|---3---|---4---|---5---|---6---|---7---|---8---|---9---|";
        CheckersBoard expectedBoard = CheckersBoard.stringToCheckersBoard(expectedBoardString);

        // WHEN
        CheckersBoard result = checkersRulesService.getInitializedCheckersBoard();

        // THEN
        assertThat(result).isEqualTo(expectedBoard);
    }

    @Test
    public void isValidMoveShouldReturnTrue() {
        // GIVEN
        String boardString =
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "9|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "8|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "7|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "6|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "5|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "4|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "3|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "2|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "1|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "0|   x   |       |       |       |       |       |       |       |       |       |\n" +
            " |---0---|---1---|---2---|---3---|---4---|---5---|---6---|---7---|---8---|---9---|";
        CheckersBoard board = CheckersBoard.stringToCheckersBoard(boardString);

        String movedBoardString =
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "9|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "8|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "7|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "6|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "5|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "4|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "3|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "2|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "1|       |   x   |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "0|       |       |       |       |       |       |       |       |       |       |\n" +
            " |---0---|---1---|---2---|---3---|---4---|---5---|---6---|---7---|---8---|---9---|";
        CheckersBoard movedBoard = CheckersBoard.stringToCheckersBoard(movedBoardString);

        // WHERE
        boolean isValid = checkersRulesService.isValidMove(board, movedBoard, Player.PLAYER_1);

        // THEN
        assertThat(isValid).isTrue();
    }

    @Test
    public void isValidateMoveShouldReturnFalse() {
        // GIVEN
        String boardString =
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "9|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "8|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "7|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "6|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "5|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "4|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "3|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "2|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "1|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "0|   x   |       |       |       |       |       |       |       |       |       |\n" +
            " |---0---|---1---|---2---|---3---|---4---|---5---|---6---|---7---|---8---|---9---|";
        CheckersBoard board = CheckersBoard.stringToCheckersBoard(boardString);

        String movedBoardString =
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "9|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "8|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "7|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "6|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "5|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "4|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "3|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "2|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "1|       |       |       |       |       |       |       |       |       |       |\n" +
            " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
            "0|       |       |       |       |       |       |       |       |       |       |\n" +
            " |---0---|---1---|---2---|---3---|---4---|---5---|---6---|---7---|---8---|---9---|";
        CheckersBoard movedBoard = CheckersBoard.stringToCheckersBoard(movedBoardString);

        // WHERE
        boolean isValid = checkersRulesService.isValidMove(board, movedBoard, Player.PLAYER_1);

        // THEN
        assertThat(isValid).isFalse();
    }

    @Test
    public void getAvailableMovesTest() {
        // GIVEN
        String boardString =
                " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
                "9|       |   o   |       |   o   |       |   o   |       |   o   |       |   o   |\n" +
                " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
                "8|   o   |       |   o   |       |   o   |       |   o   |       |   o   |       |\n" +
                " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
                "7|       |   o   |       |   o   |       |   o   |       |   o   |       |   o   |\n" +
                " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
                "6|   o   |       |   o   |       |   o   |       |   o   |       |   o   |       |\n" +
                " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
                "5|       |       |       |       |       |       |       |       |       |       |\n" +
                " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
                "4|       |       |       |       |       |       |       |       |       |       |\n" +
                " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
                "3|       |   x   |       |   x   |       |   x   |       |   x   |       |   x   |\n" +
                " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
                "2|   x   |       |   x   |       |   x   |       |   x   |       |   x   |       |\n" +
                " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
                "1|       |   x   |       |   x   |       |   x   |       |   x   |       |   x   |\n" +
                " |-------|-------|-------|-------|-------|-------|-------|-------|-------|-------|\n" +
                "0|   x   |       |   x   |       |   x   |       |   x   |       |   x   |       |\n" +
                " |---0---|---1---|---2---|---3---|---4---|---5---|---6---|---7---|---8---|---9---|";
        CheckersBoard checkersBoard = CheckersBoard.stringToCheckersBoard(boardString);
        Case[] board = checkersBoard.getCases();

        List<CheckersBoard> expected = Arrays.asList(
                new CheckersBoard(CheckersCasesTool.moveCaseFrom(board, 15, 20)),
                new CheckersBoard(CheckersCasesTool.moveCaseFrom(board, 15, 21)),
                new CheckersBoard(CheckersCasesTool.moveCaseFrom(board, 16, 21)),
                new CheckersBoard(CheckersCasesTool.moveCaseFrom(board, 16, 22)),
                new CheckersBoard(CheckersCasesTool.moveCaseFrom(board, 17, 22)),
                new CheckersBoard(CheckersCasesTool.moveCaseFrom(board, 17, 23)),
                new CheckersBoard(CheckersCasesTool.moveCaseFrom(board, 18, 23)),
                new CheckersBoard(CheckersCasesTool.moveCaseFrom(board, 18, 24)),
                new CheckersBoard(CheckersCasesTool.moveCaseFrom(board, 19, 24))
        );

        // WHERE
        List<CheckersBoard> result = checkersRulesService.getAvailableMoves(checkersBoard, Player.PLAYER_1);

        // THEN
        assertThat(result).containsOnlyElementsOf(expected);
    }
}
